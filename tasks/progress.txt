# Ralph Progress Log
# Branch: ralph/layout-extraction
# Started: 2026-02-12

## Codebase Patterns
- Use `CGO_ENABLED=0` for all Go build/vet commands (modernc.org/sqlite requirement)
- Go binary at `/home/node/go/bin/go` — export PATH before commands
- huh forms live in `tui/forms/` (theme.go, noteform.go, tackleform.go)
- Colour palette is Ciapre (warm/earthy) — constants in tui/styles/styles.go
- padToWidth uses `ansi.Truncate` from `charmbracelet/x/ansi` — ANSI+grapheme-aware
- Column border uses `styles.Purple` for the `│` separator character

- Layout utilities now live in `tui/layout/` package (PadToWidth, NormalizeLines)
- Container struct in `tui/layout/container.go` — `Container{Width, Height}.Render(content)` guarantees exact dimensions

---

## 2026-02-12 - US-001
- Created `tui/layout/helpers.go` with exported `PadToWidth` and `NormalizeLines` functions
- Updated all call sites in `tui/tui.go` to use `layout.PadToWidth` and `layout.NormalizeLines`
- Removed original `padToWidth` and `normalizeLines` functions from `tui/tui.go`
- Removed unused `charmbracelet/x/ansi` import from tui.go (still used by layout package)
- Files changed: `tui/layout/helpers.go` (new), `tui/tui.go` (modified)
- **Learnings for future iterations:**
  - `replace_all` on Edit tool replaces ALL occurrences including function definitions — be careful when renaming call sites; remove old definitions separately
  - After extracting functions that use imports, check if the original file still needs those imports (Go compiler will error on unused imports)
---

## 2026-02-12 - US-002
- Created `tui/layout/container.go` with `Container` struct and `Render` method
- Container splits content on newlines, pads each line to Width via PadToWidth, pads/truncates to Height
- When content exceeds Height, last visible line replaced with styled "↓ More..." scroll indicator (using `styles.Purple`)
- When content has fewer lines than Height, empty lines appended to fill
- Output is always exactly Height lines, each exactly Width visual columns
- Files changed: `tui/layout/container.go` (new)
- **Learnings for future iterations:**
  - Container imports `tui/styles` for scroll indicator styling — no circular dependency since layout doesn't import tui package
  - The scroll indicator replaces the last visible line entirely (not appended as extra line)
---

## 2026-02-12 - US-003
- Created `tui/layout/columns.go` with `ComputeColumnWidths` and `JoinColumns` functions
- Exported constants: `MinTerminalWidth` (80), `Col3HideThreshold` (90), `Col3MinWidth` (18)
- `ComputeColumnWidths(termWidth)` returns (col1, col2, col3, showCol3) — encapsulates responsive breakpoint logic
- `JoinColumns(columns, widths, height)` normalizes lines, pads to width, joins with purple border separator
- Replaced ~55 lines of inline column layout code in View() with calls to layout functions
- Removed `minTerminalWidth` constant from tui.go (now `layout.MinTerminalWidth`)
- Files changed: `tui/layout/columns.go` (new), `tui/tui.go` (modified)
- **Learnings for future iterations:**
  - Check ALL references to a constant/function before removing — `minTerminalWidth` was used in both `View()` and `Update()` (key filtering for mini player mode)
  - `JoinColumns` is generic over any number of columns — works for both 2-col and 3-col layouts
---

## 2026-02-12 - US-004
- Wrapped `renderColumn1`, `renderColumn2`, `renderColumn3` return values with `layout.Container{Width, Height}.Render(...)`
- Simplified `JoinColumns` — no longer calls `NormalizeLines`/`PadToWidth` per line since containers guarantee exact dimensions
- JoinColumns still handles edge cases (row beyond column line count) as a safety net
- Scroll indicator ("↓ More...") will appear on column 1 when playback info + selected tag + controls exceeds available height
- Files changed: `tui/tui.go` (modified), `tui/layout/columns.go` (modified)
- **Learnings for future iterations:**
  - Container.Render guarantees exact Height lines each exactly Width wide — downstream consumers can rely on this contract
  - renderColumn2 passes `listHeight` (clamped to min 3) to NotesList but wraps with Container at full `height` — Container handles any mismatch
---

