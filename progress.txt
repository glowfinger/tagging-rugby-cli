## Codebase Patterns
- Use `CGO_ENABLED=0` for all Go build/vet commands (required for modernc.org/sqlite)
- Go binary is at `/home/node/go/bin/go` - use `export PATH="$PATH:/home/node/go/bin"` before Go commands
- Database migrations live in db/sql/migrations/ as NNN_name.sql, embedded via db/migrations.go
- SQL queries live in db/sql/*.sql files, embedded via go:embed in db/queries.go
- SQL constants in db/queries.go use //go:embed — any new .sql file needs a matching embed var there

---

## 2026-02-19 - US-001
- Updated db/sql/migrations/001_create_videos_table.sql note_clips CREATE TABLE statement
- Removed old columns: name (TEXT), duration (REAL), error (TEXT)
- Added new columns: folder (TEXT), filename (TEXT), extension (TEXT), format (TEXT), filesize (INTEGER), status (TEXT), log (TEXT)
- Retained: id, note_id (NOT NULL REFERENCES notes(id) ON DELETE CASCADE), started_at, finished_at, error_at
- All other tables in file unchanged; go vet passes
- **Learnings for future iterations:**
  - note_clips previously had name/duration/error; now uses folder/filename/extension/format/filesize/status/log
  - started_at, finished_at, error_at were already present and are kept
---

## 2026-02-19 - US-002
- Updated db/models.go NoteClip struct: removed Name/Duration/Error, added Folder/Filename/Extension/Format/Filesize/Status/Log
- Updated db/functions.go InsertNoteWithChildren clip loop and SelectNoteClipsByNote scan to new fields
- Updated tui/tui.go addClip to use new struct fields (removed unused clipDuration var)
- Updated cmd/clip.go clip creation and Name→Filename read for clip play command
- **Learnings for future iterations:**
  - NoteClip struct change cascades to tui.go, cmd/clip.go, db/functions.go
  - When Name was used for display, Filename is the new equivalent
  - clip.go uses clipName from args[0] as the Filename field on creation
---

## 2026-02-19 - US-003
- Updated db/sql/insert_note_clip.sql: removed name/duration/error, added folder/filename/extension/format/filesize/status/log (11 cols after note_id, 11 placeholders)
- Updated db/sql/select_note_clips_by_note.sql: same column reorder, SELECT now returns 12 columns total
- go vet passes
- **Learnings for future iterations:**
  - insert_note_clip.sql now has 12 bound params (noteID + 11 new cols)
  - select returns 12 cols: id, note_id, folder, filename, extension, format, filesize, status, started_at, finished_at, error_at, log
---

## 2026-02-19 - US-004
- Created db/sql/update_note_clip.sql: UPDATE note_clips SET status=?, started_at=?, finished_at=?, error_at=?, log=? WHERE id=?
- Created db/sql/select_note_clip_by_id.sql: SELECT all 12 columns WHERE id=?
- Added SelectNoteClipByIDSQL embed to db/queries.go (in select section after SelectNoteClipsByNoteSQL)
- Added UpdateNoteClipSQL embed to db/queries.go (in update section after UpdateNoteTimingSQL)
- go vet passes
---

## 2026-02-19 - US-005
- Updated InsertNoteClip signature: folder, filename, extension, format string, filesize int64, status string, startedAt, finishedAt, errorAt interface{}, log string
- Added SelectNoteClipByID(database *sql.DB, id int64) (*NoteClip, error) using SelectNoteClipByIDSQL
- Added UpdateNoteClip(database *sql.DB, id int64, status string, startedAt, finishedAt, errorAt interface{}, log string) using UpdateNoteClipSQL
- InsertNoteWithChildren clip loop and SelectNoteClipsByNote scan were already updated in US-002
- go vet passes; all 5 stories complete
- **Learnings for future iterations:**
  - UpdateNoteClip arg order: status, startedAt, finishedAt, errorAt, log, id (WHERE id is last)
  - InsertNoteClip now takes 11 args after noteID matching new SQL column order
---
