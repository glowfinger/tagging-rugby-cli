## Codebase Patterns
- Use `CGO_ENABLED=0` for all Go build/vet commands (required for modernc.org/sqlite)
- Go binary is at `/home/node/go/bin/go` - use `export PATH="$PATH:/home/node/go/bin"` before Go commands
- Database connection uses modernc.org/sqlite (pure Go implementation, no CGO)
- Add new table migrations to the `migrate()` function in db/db.go - always use `CREATE TABLE IF NOT EXISTS`

---

## 2026-01-26 - US-001
- Initial project scaffolding with cobra CLI framework
- Created main.go and cmd/root.go with root and version commands
- Files changed: main.go, cmd/root.go, go.mod, go.sum
- **Learnings for future iterations:**
  - Typecheck with CGO_ENABLED=0 to avoid CGO issues
  - cobra CLI structure: main.go calls cmd.Execute(), cmd/root.go defines rootCmd

---

## 2026-01-26 - US-002
- What was implemented: SQLite database setup with Open function
- Files changed: db/db.go, go.mod, go.sum
- **Learnings for future iterations:**
  - Database file stored at ~/.local/share/tagging-rugby-cli/data.db
  - Uses modernc.org/sqlite for pure Go SQLite (no CGO required)
  - db.Open() creates parent directories automatically
  - Always verify connection with db.Ping() before returning

---

## 2026-01-26 - US-003
- What was implemented: Notes table migration with idempotent CREATE TABLE IF NOT EXISTS
- Files changed: db/db.go
- **Learnings for future iterations:**
  - Migrations run automatically via migrate() helper in db.Open()
  - Add future table migrations to the migrate() function
  - Each table creation should use CREATE TABLE IF NOT EXISTS for idempotency

---

## 2026-01-26 - US-004
- What was implemented: Clips table migration for storing video segments
- Files changed: db/db.go
- **Learnings for future iterations:**
  - Follow same pattern as notes table: add to migrate() function with CREATE TABLE IF NOT EXISTS
  - Clips table stores start_seconds and end_seconds (REAL) to define video segments

---

## 2026-01-26 - US-005
- What was implemented: Categories table migration with default category seeding
- Files changed: db/db.go
- **Learnings for future iterations:**
  - Use `INSERT OR IGNORE INTO` for idempotent seeding of default values
  - Default categories: try, tackle, turnover, lineout, scrum, penalty, kick
  - Categories table has UNIQUE constraint on name column

---

## 2026-01-26 - US-006
- What was implemented: Tackles table migration for detailed tackle tracking
- Files changed: db/db.go
- **Learnings for future iterations:**
  - Use SQLite CHECK constraint for enum-like fields: `outcome TEXT CHECK(outcome IN ('missed', 'completed', 'possible', 'other'))`
  - Star field is INTEGER (0/1) since SQLite has no native boolean type

---

## 2026-01-26 - US-007
- What was implemented: mpv IPC client with Unix socket connection
- Files changed: mpv/client.go (new file)
- **Learnings for future iterations:**
  - mpv package provides Client struct with Connect() and Close() methods
  - Default socket path: /tmp/tagging-rugby-mpv.sock (defined as DefaultSocketPath constant)
  - Use sync.Mutex for thread-safe connection handling
  - Custom errors: ErrNotConnected, ErrSocketNotFound for clear error handling

---

## 2026-01-26 - US-008
- What was implemented: sendCommand method for mpv IPC JSON protocol
- Files changed: mpv/client.go
- **Learnings for future iterations:**
  - mpv IPC uses JSON with format: `{"command": [cmd, args...], "request_id": <id>}`
  - Responses include `data`, `error`, and `request_id` fields
  - Use request_id to match responses since mpv can send async events
  - Use bufio.Reader for efficient line-based reading (responses are newline-terminated)
  - Error field is "success" on success, otherwise contains error message
  - Use sync/atomic for thread-safe request ID generation

---

## 2026-01-26 - US-009
- What was implemented: Get/set property methods for mpv IPC client
- Files changed: mpv/client.go
- **Learnings for future iterations:**
  - Use `get_property` and `set_property` mpv commands for property access
  - mpv property names use hyphens (e.g., "time-pos", "ab-loop-a")
  - JSON unmarshals numbers as float64 - use helper function to handle type conversions
  - Boolean properties (like "pause") return Go bool type directly from JSON
  - Convenience methods (GetTimePos, GetDuration, GetPaused) wrap GetProperty for type safety

---

## 2026-01-26 - US-010
- What was implemented: Playback control methods for mpv IPC client
- Files changed: mpv/client.go
- **Learnings for future iterations:**
  - Use `seek` command with "absolute" or "relative" as second argument for seeking
  - Play/Pause simply set the "pause" property to false/true
  - TogglePause reads current state then inverts it
  - mpv seek command: `{"command": ["seek", <seconds>, "<mode>"]}`

---

## 2026-01-26 - US-011
- What was implemented: Advanced playback controls - speed, frame stepping, and mute
- Files changed: mpv/client.go
- **Learnings for future iterations:**
  - mpv `speed` property accepts float multipliers (1.0 = normal, 0.5 = half, 2.0 = double)
  - `frame-step` and `frame-back-step` are mpv commands (not properties) for single frame navigation
  - `mute` property is a boolean for audio muting
  - Boolean properties (pause, mute) return Go bool directly from JSON unmarshal

---

## 2026-01-26 - US-012
- What was implemented: A-B loop controls for clip playback
- Files changed: mpv/client.go
- **Learnings for future iterations:**
  - A-B loop uses `ab-loop-a` and `ab-loop-b` properties (hyphens, not underscores)
  - To clear the loop, set both properties to the string "no" (not a boolean or nil)
  - SetProperty accepts any interface{} so strings and floats both work

---

## 2026-01-26 - US-013
- What was implemented: Dependency checker with doctor command
- Files changed: deps/deps.go (new), cmd/root.go
- **Learnings for future iterations:**
  - Use `exec.LookPath` to check if a binary is available in PATH
  - deps package provides CheckMpv, CheckFfmpeg, and CheckAll functions
  - DependencyError type includes name and install URL for user-friendly messages
  - Doctor command exits with code 1 if any dependency is missing

---

## 2026-01-26 - US-014
- What was implemented: LaunchMpv function to start mpv with IPC socket
- Files changed: mpv/launch.go (new)
- **Learnings for future iterations:**
  - LaunchMpv is in separate file mpv/launch.go (keeps concerns separated from client.go)
  - Uses deps.CheckMpv() to verify mpv is installed before launching
  - Returns *exec.Cmd which can be used to Wait() or Kill() the process later
  - Uses cmd.Start() (non-blocking) rather than cmd.Run() (blocking)
  - Socket path is shared via mpv.DefaultSocketPath constant

---
