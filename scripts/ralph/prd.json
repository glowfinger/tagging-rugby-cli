{
  "project": "tagging-rugby-cli",
  "branchName": "ralph/export-player-clips",
  "description": "Export Player Tackle Clips - Extract individual tackle clips organized by player using ffmpeg from TUI",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add export clips keybinding to TUI",
      "description": "As a user, I want to trigger clip export from the TUI with a keybinding so I can quickly generate clips without leaving my workflow.",
      "acceptanceCriteria": [
        "Add keybinding (E for Export) to main TUI view that triggers export flow",
        "Keybinding only active when not in command mode, forms, or other overlays",
        "Add 'Export  [ E ]' entry to help overlay (tui/components/help.go)",
        "Update /home/node/.claude/projects/-workspace/memory/MEMORY.md with export keybinding pattern",
        "CGO_ENABLED=0 go vet ./... passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-002",
      "title": "Query tackles with player and timing data",
      "description": "As a developer, I need to query all tackles with player information and timing data so I can generate clips for each player.",
      "acceptanceCriteria": [
        "Create db/sql/select_tackles_for_export.sql that joins note_tackles, note_timing, note_details",
        "Query selects: player name, timestamp, clip_start, clip_end, note_id from note_tackles table",
        "Query filters: WHERE player IS NOT NULL AND player != '' AND video_file_path = ?",
        "Query orders: ORDER BY player ASC, timestamp ASC",
        "Add Go function in db/queries.go: SelectTacklesForExport(videoPath string) ([]TackleClipData, error)",
        "Define TackleClipData struct in db/models.go with fields: Player, Timestamp, ClipStart, ClipEnd, NoteID",
        "CGO_ENABLED=0 go vet ./... passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-003",
      "title": "Calculate clip timestamps with 4-second minimum",
      "description": "As a developer, I need to calculate accurate clip start/end times using database timing data with a 4-second minimum before the tackle.",
      "acceptanceCriteria": [
        "Create pkg/cliputil/cliputil.go with CalculateClipBounds function",
        "Function signature: CalculateClipBounds(timestamp, clipStart, clipEnd, videoDuration float64) (start, end float64)",
        "If clipStart and clipEnd are both non-zero, use those values directly",
        "If clipStart is zero: calculate start = max(0, timestamp - 4.0)",
        "If clipEnd is zero: calculate end = min(videoDuration, timestamp + 10.0)",
        "Return (start, end) ensuring start >= 0 and end <= videoDuration",
        "CGO_ENABLED=0 go vet ./... passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-004",
      "title": "Execute ffmpeg to extract clips as H.264 MP4",
      "description": "As a developer, I need to execute ffmpeg commands to extract video clips in a compatible format.",
      "acceptanceCriteria": [
        "Create pkg/cliputil/export.go with ExtractClip function",
        "Function signature: ExtractClip(inputPath string, start, end float64, outputPath string) error",
        "Build ffmpeg command: ffmpeg -ss {start} -i {inputPath} -t {duration} -c:v libx264 -c:a aac -preset fast {outputPath}",
        "Duration calculated as: end - start",
        "Use exec.Command to run ffmpeg, capture stderr for error messages",
        "Return error with stderr output if ffmpeg fails (exit code != 0)",
        "Quote file paths properly to handle spaces",
        "CGO_ENABLED=0 go vet ./... passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-005",
      "title": "Organize clips in player-named folders",
      "description": "As a user, I want clips organized in folders by player name so I can easily find and share specific player highlights.",
      "acceptanceCriteria": [
        "Create pkg/cliputil/paths.go with helper functions for file organization",
        "SanitizePlayerName(player string) string - replace spaces with underscores, remove /\\:*?\"<>| chars",
        "FormatTimestamp(seconds float64) string - convert to H-MM-SS format (replace colons with hyphens)",
        "GetOutputDir(videoPath string) string - return {video-basename}-clips/ directory path",
        "GetPlayerClipPath(outputDir, player, timestamp string) string - return {outputDir}/{player}/{player}_{timestamp}_tackle.mp4",
        "Handle empty player name by using 'Unknown' as folder name",
        "Use filepath.Join for cross-platform path compatibility",
        "CGO_ENABLED=0 go vet ./... passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-006",
      "title": "Show export progress in TUI",
      "description": "As a user, I want to see export progress so I know the operation is working and how long it will take.",
      "acceptanceCriteria": [
        "Create cmd/export.go with ExportPlayerClips function that takes Model and returns tea.Cmd",
        "Check ffmpeg installed with exec.LookPath before starting, return error Cmd if not found",
        "Query tackles using SelectTacklesForExport, return error Cmd if query fails or no tackles found",
        "Create output directories with os.MkdirAll before processing clips",
        "Run export in goroutine, send progress messages via channel: start, progress (N/total), complete, error",
        "Update m.commandInput.Result with messages: 'Exporting N clips...', 'Processing clip N/total', 'Exported N clips to {dir}'",
        "Return tea.Cmd that listens to progress channel and updates UI",
        "CGO_ENABLED=0 go vet ./... passes"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-007",
      "title": "Check dependencies and handle errors",
      "description": "As a user, I want clear error messages if ffmpeg is not installed or if export fails so I know how to fix the issue.",
      "acceptanceCriteria": [
        "Check ffmpeg with exec.LookPath at start of export, return error if not found",
        "Error message for missing ffmpeg: 'ffmpeg not found. Install: brew install ffmpeg (macOS) or apt install ffmpeg (Linux)'",
        "Error message for no tackles: 'No tackles with player data found for this video'",
        "Error message for missing video file: 'Video file not found: {path}'",
        "Error message for disk write failure: 'Failed to create directory: {path} - {error}'",
        "Error message for ffmpeg failure: 'ffmpeg error: {stderr output}'",
        "All error messages displayed in m.commandInput.Result area with 3-second auto-clear",
        "CGO_ENABLED=0 go vet ./... passes"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    }
  ]
}
