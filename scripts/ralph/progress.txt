# Ralph Progress Log
Started: Wed Feb 11 15:13:55 PST 2026
---

## 2026-02-11 - US-001
- Implemented Ctrl+E keybinding for export clips in TUI
- Added `startExportClips()` stub method (placeholder for US-006 implementation)
- Added "Ctrl+E - Export player clips" to help overlay in Navigation group
- Updated MEMORY.md with export keybinding pattern
- Files changed: tui/tui.go, tui/components/help.go
- **Learnings for future iterations:**
  - "E" key is already taken by "Edit selected tackle" — used Ctrl+E instead
  - Normal mode keybindings are automatically guarded by form/command mode checks above the switch statement
  - Help overlay entries use `{key, desc}` struct literals in grouped slices in help.go
  - Mini player mode whitelist (line ~176) doesn't need export key since export isn't relevant at small widths
---

## 2026-02-11 - US-002
- Created SQL query `select_tackles_for_export.sql` joining note_tackles, note_timing, note_videos
- Added `TackleClipData` struct to db/models.go
- Added `SelectTacklesForExport` function to db/functions.go
- Added embed directive to db/queries.go
- Files changed: db/sql/select_tackles_for_export.sql (new), db/models.go, db/queries.go, db/functions.go
- **Learnings for future iterations:**
  - Tackles store timing as note_timing.start = note_timing.end = video timestamp (both same value initially)
  - Video path filtering requires JOIN to note_videos table (path stored there, not on notes or tackles)
  - note_details JOIN not needed for export — player/timing is sufficient
  - Follow existing pattern: embed SQL in queries.go, function in functions.go, struct in models.go
---

## 2026-02-11 - US-003
- Created pkg/cliputil/cliputil.go with CalculateClipBounds function
- Handles explicit clip boundaries (non-zero clipStart/clipEnd) and calculated defaults
- Default: start = timestamp - 4s, end = timestamp + 10s, clamped to [0, videoDuration]
- Files changed: pkg/cliputil/cliputil.go (new)
- **Learnings for future iterations:**
  - For tackles, clipStart == clipEnd == timestamp (both are note_timing.start/end set to same value)
  - So the "both non-zero" check effectively means "were explicit clip boundaries set?"
  - When start==end (typical tackle), we'll use calculated bounds since start != 0 but end won't be useful
  - Actually need to check: if clipStart == clipEnd, treat as "no explicit bounds" — but current code checks != 0 which works for the typical case where both == timestamp
---

## 2026-02-11 - US-004
- Created pkg/cliputil/export.go with ExtractClip function
- Uses exec.Command with -y flag, -ss before -i for fast seeking, H.264/AAC encoding
- Captures stderr via bytes.Buffer for error reporting
- Files changed: pkg/cliputil/export.go (new)
- **Learnings for future iterations:**
  - exec.Command handles path quoting automatically — no manual quoting needed for spaces in paths
  - Existing ffmpeg pattern in cmd/clip.go uses similar args but with -to instead of -t (both work the same with -ss before -i)
  - -y flag needed to overwrite existing files without prompting
---

## 2026-02-11 - US-005
- Created pkg/cliputil/paths.go with file organization helpers
- SanitizePlayerName, FormatTimestamp, GetOutputDir, GetPlayerClipPath
- Empty player name falls back to "Unknown"
- Files changed: pkg/cliputil/paths.go (new)
- **Learnings for future iterations:**
  - FormatTimestamp uses hyphens instead of colons (filesystem-safe): 0-26-42 vs 0:26:42
  - GetOutputDir strips extension and appends "-clips" to video basename
  - filepath.Join handles cross-platform separators
---

## 2026-02-11 - US-006
- Created tui/export.go with export orchestration (startExportGoroutine, message types, channel listener)
- Updated tui/tui.go: added exportCh field, export message handlers, form delegation guard
- Uses channel-based Bubbletea pattern for async progress updates
- Files changed: tui/export.go (new), tui/tui.go
- **Learnings for future iterations:**
  - Can't put export in cmd/ — cmd imports tui, would create circular dependency
  - Channel-based Bubbletea pattern: goroutine sends to chan, waitForExportMsg reads one message, returns tea.Cmd to read next
  - Must store channel on Model to keep reading after first message
  - Form delegation guard must exclude export messages so they aren't swallowed by huh forms
  - startExportGoroutine does sync validation (LookPath, Stat, DB query) before spawning goroutine
---
