# Ralph Progress Log
Started: Mon Feb  9 15:36:20 PST 2026
---

## Codebase Patterns
- huh form theme in `tui/forms/theme.go` references styles constants from `tui/styles/styles.go` — update styles first, then theme
- Use `styles.Purple` (#5C4F4B) for all border colours, `styles.Red` for errors instead of `styles.Pink`
- `styles.Cyan` (#3097C6) is the standard interactive/info colour across forms and main TUI
- Column layout: renderColumn functions return raw content (no lipgloss Width/Height wrapping) — padToWidth handles exact width per line
- Use `ansi.Truncate()` from `charmbracelet/x/ansi` for ANSI+grapheme-aware truncation (handles emoji correctly)
- Never use hand-rolled ANSI truncation — `truncateToWidth` was buggy with double-width chars, replaced by `ansi.Truncate`
---

## 2026-02-09 - US-003
- Updated huh form theme (tui/forms/theme.go) to match Ciapre palette
- Changed focused border from BrightPurple to Purple (#5C4F4B brown) for consistent border styling
- Changed error indicators/messages from Pink to Red (#AC3835) for proper error colour semantics
- Changed blurred card border from DeepPurple to Purple for border consistency
- Files changed: tui/forms/theme.go
- **Learnings for future iterations:**
  - theme.go already used styles.* constants, so the main palette change in US-002 automatically propagated most colours
  - Only borders (focused base, blurred card) and error colours needed manual fixes — they were using semantic mismatches (BrightPurple for borders, Pink for errors)
  - The Ciapre palette maps: Purple=borders, BrightPurple=highlights, Red=errors, Cyan=interactive
---

## 2026-02-09 - US-004
- Fixed jagged column borders by replacing hand-rolled truncateToWidth with ansi.Truncate
- Removed double-processing: renderColumn functions no longer apply lipgloss Width/Height/Background
- padToWidth now uses ansi.Truncate for proper ANSI-aware, grapheme-aware truncation
- Added charmbracelet/x/ansi as a direct dependency (was already indirect via lipgloss)
- Files changed: tui/tui.go, go.mod
- **Learnings for future iterations:**
  - The old truncateToWidth counted every rune as width 1, breaking emoji (2-cell width)
  - lipgloss.Width() uses go-runewidth internally and IS correct — but truncateToWidth didn't
  - Double-processing (lipgloss Width/Height render + padToWidth) caused inconsistent line widths
  - charmbracelet/x/ansi.Truncate handles: ANSI escapes, grapheme clusters, double-width chars
  - Always let padToWidth be the single source of truth for column line width
---
